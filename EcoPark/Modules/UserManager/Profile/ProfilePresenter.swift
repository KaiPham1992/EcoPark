//
//  ProfilePresenter.swift
//  EnglishApp
//
//  Created Tu DV on 10/29/19.
//  Copyright © 2019 demo. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit

class ProfilePresenter: ProfilePresenterProtocol, ProfileInteractorOutputProtocol {

    weak private var view: ProfileViewProtocol?
    var interactor: ProfileInteractorInputProtocol?
    private let router: ProfileWireframeProtocol

    init(interface: ProfileViewProtocol, interactor: ProfileInteractorInputProtocol?, router: ProfileWireframeProtocol) {
        self.view = interface
        self.interactor = interactor
        self.router = router
    }
    
    func updateAvatar(image: UIImage) {
        
        ProgressView.shared.showProgressOnWindow()
        Provider.shared.userAPIService.uploadAvatar(image: image, success: { _user in
            guard let user = UserDefaultHelper.shared.loginUserInfo else {return }
            ProgressView.shared.hide()

            user.imgSrc = _user?.imgSrc
            user.imgCropSrc = _user?.imgCropSrc
            UserDefaultHelper.shared.loginUserInfo = user
            self.view?.didUpdateAvatar()
        }, failure: { error in
            ProgressView.shared.hide()
//            self.presenter?.didErrorUpdateProfile(error: error)
        })
    }

    func updateProfile(param: UpdateProfileParam) {
        ProgressView.shared.showProgressOnWindow()
        Provider.shared.userAPIService.updateProfile(param: param, success: { (user) in
            guard let _user = user else { return }
            ProgressView.shared.hide()
            self.view?.didUpdateProfile(user: _user)
        }) { (error) in
            ProgressView.shared.hide()
        }
    }
    
    func getProfile() {
        ProgressView.shared.showProgressOnWindow()
        Provider.shared.userAPIService.getProfileUser(success: { (user) in
            ProgressView.shared.hide()
            guard let _user = user else { return }
            self.view?.didGetProfile(user: _user)
        }) { (_) in
            ProgressView.shared.hide()
        }
    }
}
