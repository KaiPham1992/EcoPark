//
//  HistoryParkingViewController.swift
//  EcoPark
//
//  Created Steve on 11/1/19.
//  Copyright © 2019 demo. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit
import XLPagerTabStrip

enum TypeHistoryParking {
    case doing
    case history
}

class HistoryParkingViewController: ListManagerVC {

	var presenter: HistoryParkingPresenterProtocol?
    var type: TypeHistoryParking = .doing
    
    override func setUpViews() {
        super.setUpViews()
        loadData()
        self.view.backgroundColor = .clear
        
    }
    
    func loadData() {
        if type == .doing {
            self.presenter?.getDoingBooking()
        } else {
            self.presenter?.getHistoryBooking()
        }
    }

    override func registerTableView() {
        super.registerTableView()
        self.tableView.registerXibFile(DoingCell.self)
    }
    
    override func cellForRowListManager(item: Any, _ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        let cell = self.tableView.dequeue(DoingCell.self, for: indexPath)
        cell.setupCell(data: item as! HistoryBookingParkingResponse)
        return cell
    }
    
    override func didSelectTableView(item: Any, indexPath: IndexPath) {
        guard let historyBookingParking = item as? HistoryBookingParkingResponse else { return }
    
        var vc : DetailParkingViewController
        if indexPath.row == 0 {
            vc = DetailParkingRouter.createModule(bookingParking: historyBookingParking)
        } else if indexPath.row == 1 {
            vc = DetailParkingRouter.createModule(bookingParking: historyBookingParking)
        } else {
            vc = DetailParkingRouter.createModule(bookingParking: historyBookingParking)
        }
        vc.delegate = self
        self.push(controller: vc, animated: true)
    }
}

extension HistoryParkingViewController: DetailParkingViewControllerDelegate {
    func dataChanged() {
        loadData()
    }
}

extension HistoryParkingViewController: IndicatorInfoProvider {
    func indicatorInfo(for pagerTabStripController: PagerTabStripViewController) -> IndicatorInfo {
        return self.type == .doing ? IndicatorInfo(title: LocalizableKey.doing.showLanguage) : IndicatorInfo(title: LocalizableKey.history.showLanguage)
    }
}

extension HistoryParkingViewController : HistoryParkingViewProtocol{
    func reloadViewDoingBooking(data: [HistoryBookingParkingResponse]) {
        self.initLoadData(data: data)
    }
    
    func reloadViewHistoryBooking(data: [HistoryBookingParkingResponse]) {
        self.initLoadData(data: data)
    }
}

